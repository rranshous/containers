machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - cd rsyncd && docker build -t rranshous/rsyncd .
    - cd beanstalkd && docker build -t rranshous/beanstalkd .
    - cd ffmpeg && docker build -t rranshous/ffmpeg .
    - cd http_listing && docker build -t rranshous/http_listing .
    - cd mosquitto && docker build -t rranshous/mosquitto .
    - cd openvpn && docker build -t rranshous/openvpn .
    - cd rdiff-backup && docker build -t rranshous/rdiff .
    - cd transmission && docker build -t rranshous/transmission .
    - cd turbolift && docker build -t rranshous/turbolift .
    - cd ums && docker build -t rranshous/ums .
    - cd zfs && docker build -t rranshous/zfs .

test:
  override:
    - docker run -d rranshous/rsyncd
    - docker run -d rranshous/beanstalkd
    - docker run -d rranshous/ffmpeg
    - docker run -d rranshous/http_listing
    - docker run -d rranshous/mosquitto
    - docker run -d rranshous/openvpn
    - docker run -d rranshous/rdiff-backup
    - docker run -d rranshous/transmission
    - docker run -d rranshous/turbolift
    - docker run -d rranshous/ums
    - docker run -d rranshous/zfs

deployment:
  hub:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push rranshous/rsyncd
      - docker push rranshous/beanstalkd
      - docker push rranshous/ffmpeg
      - docker push rranshous/http_listing
      - docker push rranshous/mosquitto
      - docker push rranshous/openvpn
      - docker push rranshous/rdiff-backup
      - docker push rranshous/transmission
      - docker push rranshous/turbolift
      - docker push rranshous/ums
      - docker push rranshous/zfs
